<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOLOv8 AI Counter üöÄ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ */
        :root {
            --primary-color: #007bff;     /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏Å */
            --secondary-color: #343a40;  /* ‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
            --background-color: #f8f9fa; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≠‡∏ô */
            --card-background: #ffffff; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î */
            --success-color: #28a745;    /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå */
            --error-color: #dc3545;      /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Error */
            --loading-color: #ffc107;    /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Loading */
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--background-color);
            padding: 40px 15px; 
            text-align: center; 
            min-height: 100vh;
        }

        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background-color: var(--card-background);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            color: var(--secondary-color);
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #888;
            margin-bottom: 30px;
            font-weight: 400;
        }

        /* ------------------ Input/Button Style ------------------ */
        .upload-area {
            padding: 30px;
            border: 2px dashed #ced4da;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: #f0f4f8;
        }
        
        #uploadInput {
            display: none;
        }

        .custom-upload-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
            transition: background-color 0.3s ease;
        }
        .upload-area:hover .custom-upload-btn {
            background-color: #0056b3;
        }

        /* ------------------ Status/Result Style ------------------ */
        #statusDisplay {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 6px;
            font-weight: 600;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .status-loading { 
            background-color: var(--loading-color); 
            color: #495057; 
            display: block !important; 
            opacity: 1 !important;
        }
        .status-error {
            background-color: var(--error-color);
            color: white;
            display: block !important; 
            opacity: 1 !important;
        }
        .status-success {
            background-color: var(--success-color);
            color: white;
            font-size: 20px;
            display: block !important;
            opacity: 1 !important;
        }

        /* ------------------ Image Display ------------------ */
        #imageWrapper { 
            position: relative; 
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ */
            margin-top: 25px; 
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            max-height: 70vh; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
        }

        #previewImage { 
            width: 100%;
            height: auto; 
            display: block; 
        }

        #overlayCanvas { 
            position: absolute; 
            top: 0; 
            left: 0; 
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Inventory Counter</h1>
        <p class="subtitle">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ö‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ YOLOv8</p>

        <label for="uploadInput" class="upload-area">
            <button class="custom-upload-btn">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
            <input type="file" id="uploadInput" accept="image/*">
            <p style="margin-top: 10px; color: #adb5bd;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPEG, PNG (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)</p>
        </label>

        <div id="statusDisplay"></div>

        <div id="imageWrapper">
            <img id="previewImage" src="" alt="Image Preview">
            <canvas id="overlayCanvas"></canvas>
        </div>
    </div>

    <script>
        // ==========================================
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á /detect)
        // ==========================================
        const API_URL = "https://yolo-backend-api.onrender.com/detect"; 

        const input = document.getElementById('uploadInput');
        const img = document.getElementById('previewImage');
        const canvas = document.getElementById('overlayCanvas');
        const ctx = canvas.getContext('2d');
        const statusDisplay = document.getElementById('statusDisplay');
        const imageWrapper = document.getElementById('imageWrapper');
        
        // --- Event Listener ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ ---
        input.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // 1. ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            statusDisplay.className = 'status-loading';
            statusDisplay.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå... (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠)";
            
            // 2. ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
            const url = URL.createObjectURL(file);
            img.src = url;
            
            img.onload = () => {
                // ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î Canvas ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ (client size)
                canvas.width = img.clientWidth;
                canvas.height = img.clientHeight;
                
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏£‡∏¥‡∏á (natural size) ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Element ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì scale
                img.setAttribute('data-natural-width', img.naturalWidth);
                img.setAttribute('data-natural-height', img.naturalHeight);
                
                imageWrapper.style.display = 'inline-block';
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                processImage(file);
            };
        });

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏õ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ---
        async function processImage(file) {
            
            const formData = new FormData();
            formData.append("file", file);

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    body: formData
                });
                
                // ‡∏ñ‡πâ‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ HTTP ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 2xx
                if (!response.ok) {
                    let errorMsg = `Server Error (${response.status})`;
                    try {
                        const errorData = await response.json();
                        errorMsg = errorData.error || errorMsg;
                    } catch (e) {
                        // ignore JSON parse error if response body is not JSON
                    }
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                drawBoxes(data.detections);
                
                statusDisplay.className = 'status-success';
                statusDisplay.innerText = `‚úÖ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${data.detections.length} ‡∏ä‡∏¥‡πâ‡∏ô`;

            } catch (error) {
                console.error("Fetch Error:", error);
                statusDisplay.className = 'status-error';
                statusDisplay.innerText = `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}. (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Render Logs ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏)`;
            }
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î Bounding Box ---
        function drawBoxes(detections) {
            
            ctx.clearRect(0, 0, canvas.width, canvas.height); 

            // ‡∏î‡∏∂‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å Attribute ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
            const naturalWidth = parseInt(img.getAttribute('data-natural-width'));
            const naturalHeight = parseInt(img.getAttribute('data-natural-height'));

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢
            const scaleX = canvas.width / naturalWidth;
            const scaleY = canvas.height / naturalHeight;
            
            detections.forEach(det => {
                // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å AI (Original size)
                const [x1, y1, x2, y2] = det.box;
                
                // 1. ‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏à‡∏≠
                const rectX = x1 * scaleX;
                const rectY = y1 * scaleY;
                const rectW = (x2 - x1) * scaleX;
                const rectH = (y2 - y1) * scaleY;
                
                const confidence = Math.round(det.confidence * 100);

                // 2. ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö
                ctx.strokeStyle = var(--success-color);
                ctx.lineWidth = 3;
                ctx.strokeRect(rectX, rectY, rectW, rectH);

                // 3. ‡∏ß‡∏≤‡∏î‡∏õ‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
                const labelText = `${det.label} ${confidence}%`;
                ctx.fillStyle = var(--success-color);
                ctx.font = "600 14px Poppins"; 
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡πâ‡∏≤‡∏¢
                const textMetrics = ctx.measureText(labelText);
                const textWidth = textMetrics.width;
                const textHeight = 20;
                const textPadding = 5;

                // ‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡πâ‡∏≤‡∏¢ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏∏‡∏Å‡∏™‡∏µ)
                ctx.fillRect(rectX, rectY - textHeight, textWidth + (textPadding * 2), textHeight);

                // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                ctx.fillStyle = "white";
                ctx.fillText(labelText, rectX + textPadding, rectY - 5);
            });
        }
    </script>
</body>
</html>